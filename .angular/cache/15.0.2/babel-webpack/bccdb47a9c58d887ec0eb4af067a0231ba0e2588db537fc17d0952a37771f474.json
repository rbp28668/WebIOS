{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"../p3dcmd.service\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"../cmdbutton/cmdbutton.component\";\nimport * as i4 from \"../named-item/named-item.component\";\nconst _c0 = function (a1) {\n  return {\n    tablinks: true,\n    active: a1\n  };\n};\nfunction ScenariosComponent_button_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 26);\n    i0.ɵɵlistener(\"click\", function ScenariosComponent_button_4_Template_button_click_0_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r13);\n      const page_r11 = restoredCtx.$implicit;\n      const ctx_r12 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r12.selectTab($event, page_r11.name));\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const page_r11 = ctx.$implicit;\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(2, _c0, page_r11.isFirst()));\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(page_r11.name);\n  }\n}\nfunction ScenariosComponent_div_5_cmd_button_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"cmd-button\", 29);\n  }\n  if (rf & 2) {\n    const item_r17 = ctx.$implicit;\n    i0.ɵɵpropertyInterpolate(\"caption\", item_r17.title);\n    i0.ɵɵpropertyInterpolate1(\"cmd\", \"/scenario/load?file=\", item_r17.filename, \"\");\n  }\n}\nfunction ScenariosComponent_div_5_cmd_button_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"cmd-button\", 29);\n  }\n  if (rf & 2) {\n    const item_r18 = ctx.$implicit;\n    i0.ɵɵpropertyInterpolate(\"caption\", item_r18.title);\n    i0.ɵɵpropertyInterpolate1(\"cmd\", \"/position/load?file=\", item_r18.filename, \"\");\n  }\n}\nconst _c1 = function (a0, a1) {\n  return {\n    tabcontent: a0,\n    tabcontent_active: a1\n  };\n};\nfunction ScenariosComponent_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 27);\n    i0.ɵɵtemplate(1, ScenariosComponent_div_5_cmd_button_1_Template, 1, 2, \"cmd-button\", 28);\n    i0.ɵɵelementStart(2, \"h3\");\n    i0.ɵɵtext(3, \"Preset Positions\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(4, ScenariosComponent_div_5_cmd_button_4_Template, 1, 2, \"cmd-button\", 28);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const page_r14 = ctx.$implicit;\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵpropertyInterpolate(\"id\", page_r14.name);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(4, _c1, !page_r14.isFirst(), page_r14.isFirst()));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", page_r14.items);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.getPositions().safeFindItemsFor(page_r14.name).items);\n  }\n}\n// A list of named items with a common (site) name.\nclass NamedItemList {\n  constructor(name, index) {\n    this.name = name;\n    this.items = new Array();\n    this.index = index;\n  }\n  add(item) {\n    this.items.push(item);\n  }\n  isFirst() {\n    return this.index == 0;\n  }\n}\n// List of pages of scenarios.\n// TODO maybe look at improving with StringMap\nclass GroupedItems {\n  constructor() {\n    this.pages = new Array();\n  }\n  add(item) {\n    var fragments = item.filename.split('_');\n    var site = \"Other\";\n    if (fragments[0] === 'IOS') {\n      site = fragments[1];\n    }\n    var page = this.findItemsFor(site);\n    if (page == null) {\n      page = new NamedItemList(site, this.pages.length);\n      this.pages.push(page);\n    }\n    page.add(item);\n  }\n  findItemsFor(site) {\n    var page = null;\n    this.pages.forEach(p => {\n      if (p.name === site) {\n        page = p;\n      }\n    });\n    return page;\n  }\n  // Function that's guaranteed to return a list even if no match.\n  safeFindItemsFor(site) {\n    var page = this.findItemsFor(site);\n    if (page === null) {\n      page = new NamedItemList(\"\", 0);\n    }\n    return page;\n  }\n}\nexport class ScenariosComponent {\n  constructor(p3dcmd) {\n    this.p3dcmd = p3dcmd;\n    //private scenarios : StringMap<string, Array<NamedItem>>;\n    this.scenarios = new GroupedItems();\n    this.positions = new GroupedItems();\n  }\n  // Initialise the model.\n  ngOnInit() {\n    console.log(\"Scenarios component ngOnInit\");\n    this.loadScenarios();\n    this.loadPositions();\n  }\n  logFailure(data) {\n    console.log(\"Failed: \" + data.reason + data.code);\n  }\n  loadScenarios() {\n    this.p3dcmd.scenariosList(\"IOS\").subscribe(data => {\n      // Process resulting list\n      if (data.status === \"OK\") {\n        data.entries.forEach(item => {\n          this.scenarios.add(item);\n        });\n      } else {\n        // failed\n        this.logFailure(data);\n      }\n    }, err => {\n      console.log(\"Error fetching scenarios\");\n      console.log(err);\n    });\n  }\n  loadPositions() {\n    this.p3dcmd.positionList(\"IOS\").subscribe(data => {\n      // Process resulting list\n      if (data.status === \"OK\") {\n        data.entries.forEach(item => {\n          this.positions.add(item);\n        });\n      } else {\n        // failed\n        this.logFailure(data);\n      }\n    }, err => {\n      console.log(\"Error fetching positions\");\n      console.log(err);\n    });\n  }\n  expandDialog(button, dialog) {\n    button.setAttribute(\"style\", \"display:none\");\n    dialog.removeAttribute(\"style\");\n  }\n  contractDialog(button, dialog) {\n    dialog.setAttribute(\"style\", \"display:none\");\n    button.removeAttribute(\"style\");\n  }\n  saveScenario(details, button, dialog) {\n    this.p3dcmd.scenariosSave(details.filename(), details.title(), details.description()).subscribe(data => {\n      if (data.status !== \"OK\") {\n        this.logFailure(data);\n      }\n    }, err => {\n      console.log(\"Error saving scenario\");\n      console.log(err);\n    });\n    this.contractDialog(button, dialog);\n  }\n  savePosition(details, button, dialog) {\n    this.p3dcmd.positionSave(details.filename(), details.title(), details.description()).subscribe(data => {\n      if (data.status !== \"OK\") {\n        this.logFailure(data);\n      }\n    }, err => {\n      console.log(\"Error saving position\");\n      console.log(err);\n    });\n    this.contractDialog(button, dialog);\n  }\n  showCurrentPosition(control) {\n    this.p3dcmd.positionCurrent().subscribe(data => {\n      if (data.status === \"OK\") {\n        var current = data.current;\n        var contents = \"\";\n        if (current.latitude) {\n          contents += \"Latitude \" + current.latitude;\n        }\n        if (current.longitude) {\n          contents += \"Longitude \" + current.longitude;\n        }\n        // etc...\n        //control.setValue( contents);\n        console.log(contents);\n      } else {\n        this.logFailure(data);\n      }\n    }, err => {\n      console.log(\"Error saving position\");\n      console.log(err);\n    });\n  }\n  startRewind(rewind_slider, start_button, stop_button) {\n    console.log(rewind_slider);\n    this.p3dcmd.runCommand(\"/cmd/PAUSE_ON\").subscribe(data => {\n      if (data.status === \"OK\") {\n        this.setSliderRange(rewind_slider);\n        start_button.disabled = true;\n        rewind_slider.disabled = false;\n        stop_button.disabled = false;\n      } else {\n        this.logFailure(data);\n      }\n    }, err => {\n      console.log(\"Error pausing sim\");\n      console.log(err);\n    });\n  }\n  setSliderRange(rewind_slider) {\n    this.p3dcmd.positionAvailable().subscribe(data => {\n      if (data.status === \"OK\") {\n        rewind_slider.value = '0';\n        rewind_slider.min = '0';\n        rewind_slider.max = data.length;\n      } else {\n        this.logFailure(data);\n      }\n    }, err => {\n      console.log(\"Error fetching available positions\");\n      console.log(err);\n    });\n  }\n  rewindChange(rewind_slider) {\n    this.p3dcmd.positionBack(Number(rewind_slider.value)).subscribe(data => {\n      if (data.status !== \"OK\") {\n        this.logFailure(data);\n      }\n    }, err => {\n      console.log(\"Error rewinding to position\");\n      console.log(err);\n    });\n  }\n  stopRewind(rewind_slider, start_button, stop_button) {\n    this.p3dcmd.positionSet(parseInt(rewind_slider.value)).subscribe(data => {\n      if (data.status === \"OK\") {\n        this.unpauseSim();\n        start_button.disabled = false;\n        rewind_slider.value = \"0\";\n        rewind_slider.disabled = true;\n        stop_button.disabled = true;\n      } else {\n        this.logFailure(data);\n      }\n    }, err => {\n      console.log(\"Error rewinding to set position\");\n      console.log(err);\n    });\n  }\n  unpauseSim() {\n    this.p3dcmd.runCommand('cmd/PAUSE_OFF').subscribe(data => {\n      if (data.status !== \"OK\") {\n        this.logFailure(data);\n      }\n    }, err => {\n      console.log(\"Error un-pausing sim\");\n      console.log(err);\n    });\n  }\n  selectTab(evt, tabName) {\n    // Declare all variables\n    var i, tabcontent, tablinks;\n    // Get all active elements with class=\"tabcontent\" and hide them\n    tabcontent = document.getElementsByClassName(\"tabcontent_active\");\n    for (i = 0; i < tabcontent.length; i++) {\n      tabcontent[i].className = \"tabcontent\";\n    }\n    // Get all elements with class=\"tablinks\" and remove the class \"active\"\n    tablinks = document.getElementsByClassName(\"tablinks\");\n    for (i = 0; i < tablinks.length; i++) {\n      tablinks[i].className = tablinks[i].className.replace(\" active\", \"\");\n    }\n    // Show the current tab, and add an \"active\" class to the button that opened the tab\n    var element = document.getElementById(tabName);\n    if (element != null) element.className += \"_active\";\n    var target = evt.currentTarget;\n    if (target != null) target.className += \" active\";\n  }\n  getScenarios() {\n    return this.scenarios;\n  }\n  getPositions() {\n    return this.positions;\n  }\n}\nScenariosComponent.ɵfac = function ScenariosComponent_Factory(t) {\n  return new (t || ScenariosComponent)(i0.ɵɵdirectiveInject(i1.P3dcmdService));\n};\nScenariosComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: ScenariosComponent,\n  selectors: [[\"app-scenarios\"]],\n  decls: 55,\n  vars: 2,\n  consts: [[1, \"top-container\"], [1, \"tab\"], [3, \"ngClass\", \"click\", 4, \"ngFor\", \"ngForOf\"], [3, \"id\", \"ngClass\", 4, \"ngFor\", \"ngForOf\"], [1, \"action\", 3, \"click\"], [\"save_scenario_button\", \"\"], [2, \"display\", \"none\"], [\"save_scenario_dialog\", \"\"], [1, \"solid\"], [\"scenario_details\", \"\"], [1, \"action\", 2, \"display\", \"inline-block\", 3, \"click\"], [\"start_button\", \"\"], [1, \"slidecontainer\", 2, \"display\", \"inline-block\", \"width\", \"80%\"], [\"type\", \"range\", \"min\", \"1\", \"max\", \"100\", \"value\", \"50\", \"disabled\", \"true\", 1, \"slider\", 2, \"display\", \"inline-block\", \"width\", \"100%\", 3, \"change\"], [\"rewind_slider\", \"\"], [\"disabled\", \"true\", 1, \"action\", 2, \"float\", \"right\", 3, \"click\"], [\"stop_button\", \"\"], [\"caption\", \"Up 1000 feet\", \"cmd\", \"/position/up?feet=1000\"], [\"caption\", \"Up 500 feet\", \"cmd\", \"/position/up?feet=500\"], [\"caption\", \"Up 100 feet\", \"cmd\", \"/position/up?feet=100\"], [\"caption\", \"Down 100 feet\", \"cmd\", \"/position/down?feet=100\"], [\"caption\", \"Down 500 feet\", \"cmd\", \"/position/down?feet=500\"], [\"caption\", \"Down 1000 feet\", \"cmd\", \"/position/down?feet=1000\"], [\"save_position_button\", \"\"], [\"save_position_dialog\", \"\"], [\"position_details\", \"\"], [3, \"ngClass\", \"click\"], [3, \"id\", \"ngClass\"], [3, \"caption\", \"cmd\", 4, \"ngFor\", \"ngForOf\"], [3, \"caption\", \"cmd\"]],\n  template: function ScenariosComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      const _r19 = i0.ɵɵgetCurrentView();\n      i0.ɵɵelementStart(0, \"div\", 0)(1, \"h1\");\n      i0.ɵɵtext(2, \"Scenarios\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(3, \"div\", 1);\n      i0.ɵɵtemplate(4, ScenariosComponent_button_4_Template, 2, 4, \"button\", 2);\n      i0.ɵɵelementEnd();\n      i0.ɵɵtemplate(5, ScenariosComponent_div_5_Template, 5, 7, \"div\", 3);\n      i0.ɵɵelementStart(6, \"button\", 4, 5);\n      i0.ɵɵlistener(\"click\", function ScenariosComponent_Template_button_click_6_listener() {\n        i0.ɵɵrestoreView(_r19);\n        const _r2 = i0.ɵɵreference(7);\n        const _r3 = i0.ɵɵreference(10);\n        return i0.ɵɵresetView(ctx.expandDialog(_r2, _r3));\n      });\n      i0.ɵɵtext(8, \"Save Scenario\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(9, \"div\", 6, 7)(11, \"fieldset\", 8)(12, \"legend\");\n      i0.ɵɵtext(13, \"Save Scenario\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(14, \"app-named-item\", null, 9);\n      i0.ɵɵelementStart(16, \"button\", 4);\n      i0.ɵɵlistener(\"click\", function ScenariosComponent_Template_button_click_16_listener() {\n        i0.ɵɵrestoreView(_r19);\n        const _r4 = i0.ɵɵreference(15);\n        const _r2 = i0.ɵɵreference(7);\n        const _r3 = i0.ɵɵreference(10);\n        return i0.ɵɵresetView(ctx.saveScenario(_r4, _r2, _r3));\n      });\n      i0.ɵɵtext(17, \"Save Scenario\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(18, \"button\", 4);\n      i0.ɵɵlistener(\"click\", function ScenariosComponent_Template_button_click_18_listener() {\n        i0.ɵɵrestoreView(_r19);\n        const _r2 = i0.ɵɵreference(7);\n        const _r3 = i0.ɵɵreference(10);\n        return i0.ɵɵresetView(ctx.contractDialog(_r2, _r3));\n      });\n      i0.ɵɵtext(19, \"Cancel\");\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(20, \"fieldset\", 8)(21, \"legend\");\n      i0.ɵɵtext(22, \"Rewind Position\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(23, \"button\", 10, 11);\n      i0.ɵɵlistener(\"click\", function ScenariosComponent_Template_button_click_23_listener() {\n        i0.ɵɵrestoreView(_r19);\n        const _r6 = i0.ɵɵreference(28);\n        const _r5 = i0.ɵɵreference(24);\n        const _r7 = i0.ɵɵreference(30);\n        return i0.ɵɵresetView(ctx.startRewind(_r6, _r5, _r7));\n      });\n      i0.ɵɵtext(25, \"Start\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(26, \"div\", 12)(27, \"input\", 13, 14);\n      i0.ɵɵlistener(\"change\", function ScenariosComponent_Template_input_change_27_listener() {\n        i0.ɵɵrestoreView(_r19);\n        const _r6 = i0.ɵɵreference(28);\n        return i0.ɵɵresetView(ctx.rewindChange(_r6));\n      });\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(29, \"button\", 15, 16);\n      i0.ɵɵlistener(\"click\", function ScenariosComponent_Template_button_click_29_listener() {\n        i0.ɵɵrestoreView(_r19);\n        const _r6 = i0.ɵɵreference(28);\n        const _r5 = i0.ɵɵreference(24);\n        const _r7 = i0.ɵɵreference(30);\n        return i0.ɵɵresetView(ctx.stopRewind(_r6, _r5, _r7));\n      });\n      i0.ɵɵtext(31, \"Stop\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(32, \"fieldset\", 8)(33, \"legend\");\n      i0.ɵɵtext(34, \"Move Position\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(35, \"cmd-button\", 17)(36, \"cmd-button\", 18)(37, \"cmd-button\", 19)(38, \"cmd-button\", 20)(39, \"cmd-button\", 21)(40, \"cmd-button\", 22);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(41, \"button\", 4, 23);\n      i0.ɵɵlistener(\"click\", function ScenariosComponent_Template_button_click_41_listener() {\n        i0.ɵɵrestoreView(_r19);\n        const _r8 = i0.ɵɵreference(42);\n        const _r9 = i0.ɵɵreference(45);\n        return i0.ɵɵresetView(ctx.expandDialog(_r8, _r9));\n      });\n      i0.ɵɵtext(43, \"Save Position\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(44, \"div\", 6, 24)(46, \"fieldset\", 8)(47, \"legend\");\n      i0.ɵɵtext(48, \"Save Position\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(49, \"app-named-item\", null, 25);\n      i0.ɵɵelementStart(51, \"button\", 4);\n      i0.ɵɵlistener(\"click\", function ScenariosComponent_Template_button_click_51_listener() {\n        i0.ɵɵrestoreView(_r19);\n        const _r10 = i0.ɵɵreference(50);\n        const _r8 = i0.ɵɵreference(42);\n        const _r9 = i0.ɵɵreference(45);\n        return i0.ɵɵresetView(ctx.savePosition(_r10, _r8, _r9));\n      });\n      i0.ɵɵtext(52, \"Save Position\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(53, \"button\", 4);\n      i0.ɵɵlistener(\"click\", function ScenariosComponent_Template_button_click_53_listener() {\n        i0.ɵɵrestoreView(_r19);\n        const _r8 = i0.ɵɵreference(42);\n        const _r9 = i0.ɵɵreference(45);\n        return i0.ɵɵresetView(ctx.contractDialog(_r8, _r9));\n      });\n      i0.ɵɵtext(54, \"Cancel\");\n      i0.ɵɵelementEnd()()()();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"ngForOf\", ctx.getScenarios().pages);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngForOf\", ctx.getScenarios().pages);\n    }\n  },\n  dependencies: [i2.NgClass, i2.NgForOf, i3.CmdbuttonComponent, i4.NamedItemComponent]\n});","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}